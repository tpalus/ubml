# ============================================================================
# UBML Primitive Type Definitions
# ============================================================================
# Contains primitive types for durations, money, rates, expressions, and
# calendar types used across UBML schemas.
# ============================================================================

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://ubml.talxis.com/schemas/1.2/defs/primitives.defs.yaml"
title: "UBML Primitive Types"
description: |
  Primitive value types for UBML: durations, money, rates, expressions,
  dates, and calendar types.

$defs:

  # ==========================================================================
  # MONETARY TYPES
  # ==========================================================================

  Money:
    description: |
      Monetary amount with currency.
      
      Uses ISO 4217 currency codes.
      
      Examples:
        amount: 1500.00
        currency: "EUR"
    type: object
    additionalProperties: false
    required: [amount, currency]
    examples:
      - amount: 1500
        currency: "EUR"
      - amount: 2500.50
        currency: "USD"
      - amount: 75000
        currency: "CZK"
    properties:
      amount:
        description: "Monetary amount (decimal)."
        type: number
      currency:
        description: "ISO 4217 currency code."
        type: string
        examples: ["USD", "EUR", "CZK", "GBP"]

  Rate:
    description: |
      Cost rate with currency and time unit.
      
      Used for actor/resource costing in simulation.
      
      Examples:
        # Hourly rate
        amount: 75
        currency: "EUR"
        per: h
        
        # Daily rate
        amount: 500
        currency: "USD"
        per: d
    type: object
    additionalProperties: false
    required: [amount, currency, per]
    examples:
      - amount: 75
        currency: "EUR"
        per: h
      - amount: 500
        currency: "USD"
        per: d
      - amount: 3000
        currency: "GBP"
        per: mo
    properties:
      amount:
        description: "Rate amount per time unit."
        type: number
      currency:
        description: "ISO 4217 currency code."
        type: string
      per:
        description: "Time unit for rate."
        type: string
        enum: [h, d, wk, mo]

  # ==========================================================================
  # DURATION TYPES
  # ==========================================================================

  DurationString:
    description: |
      Duration string in format: number + unit.
      
      Supported units:
      - min: minutes
      - h: hours
      - d: days
      - wk: weeks
      - mo: months
      
      Examples: "2d", "4h", "30min", "1.5wk", "3mo"
    type: string
    pattern: "^[0-9]+(\\.[0-9]+)?(min|h|d|wk|mo)$"
    examples:
      - "30min"
      - "2h"
      - "1.5d"
      - "1wk"
      - "3mo"
    x-ubml:
      humanName: "Duration"
      errorHint: "Number + unit (min, h, d, wk, mo)"
      commonMistakes:
        - pattern: "^\\d+$"
          message: "Missing unit. Did you mean \"{value}h\" or \"{value}min\"?"
        - pattern: "^\\d+\\s*(hours?|minutes?|days?)$"
          message: "Use short units: min, h, d, wk, mo"

  Duration:
    description: |
      Duration value: literal string or expression.
      
      Three forms (pick one):
      
      1. Direct string (shorthand for fixed literal):
         duration: "2d"
         duration: "4h"
      
      2. Object with fixed literal:
         duration: { fixed: "2d" }
      
      3. Object with expression (calculation or work attribute):
         duration: { expr: "tri(d(1),d(2),d(4))" }   # distribution
         duration: { expr: "baseEffort * 1.5" }      # calculation
         duration: { expr: adjustedEffort }          # work attribute
    oneOf:
      - $ref: "#/$defs/DurationString"
      - type: object
        additionalProperties: false
        required: [fixed]
        properties:
          fixed:
            description: "Fixed duration literal."
            $ref: "#/$defs/DurationString"
      - type: object
        additionalProperties: false
        required: [expr]
        properties:
          expr:
            description: |
              Expression that evaluates to a duration.
              Can be a calculation, distribution, or work attribute.
              
              Examples:
                tri(d(1),d(2),d(4))    # triangular distribution
                baseEffort * 1.5       # calculation
                adjustedEffort         # work attribute
            type: string

  # ==========================================================================
  # TIME FORMATS
  # ==========================================================================

  TimeString:
    description: |
      Time in HH:MM format (24-hour).
      
      Examples: "08:00", "17:30", "00:00", "23:59"
    type: string
    pattern: "^[0-2][0-9]:[0-5][0-9]$"

  DateString:
    description: |
      Date in ISO 8601 format (YYYY-MM-DD).
      
      Examples: "2026-01-03", "2025-12-31"
    type: string
    format: date

  # ==========================================================================
  # CALENDAR TYPES
  # ==========================================================================

  Month:
    description: |
      Three-letter month abbreviation.
      Used for scenario arrival patterns.
    type: string
    enum: [Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec]

  Weekday:
    description: |
      Three-letter weekday abbreviation.
      Used for calendar work day configuration.
    type: string
    enum: [Mon, Tue, Wed, Thu, Fri, Sat, Sun]

  # ==========================================================================
  # EXPRESSION TYPE
  # ==========================================================================

  Expression:
    description: |
      TypeScript-subset expression string (ts-subset-v1).
      
      Expressions can be:
      - Calculations: "orderValue > 50000 && customer.segment == 'enterprise'"
      - Work attribute references: isHighValue (a simple variable name)
      
      WORK ATTRIBUTES:
      Expressions can reference work attributes defined in workAttributes[]:
      - bindsTo: keys that map to information model attributes
      - expr: computed keys that derive values from other attributes
      
      USAGE EXAMPLES:
        # In guards
        guard: "isHighValue && customer.segment == 'enterprise'"
        guard: isHighValue
        
        # In durations
        duration: { expr: "adjustedEffort * 1.2" }
        duration: { expr: adjustedEffort }
      
      ALLOWED SYNTAX:
      - Literals: number, string, boolean, null
      - Operators: + - * / %, comparisons, && || !, ternary (cond ? a : b)
      - Property access: customer.region, order.value
      - Work attribute keys: orderValue, isHighValue, adjustedEffort
      - Built-in functions: tri(min,mode,max), min(...), max(...), 
        clamp(x,lo,hi), round(x,digits?), floor(x), ceil(x)
      - Duration helpers: min(x), h(x), d(x), wk(x), mo(x)
      
      DISALLOWED:
      - Assignments, loops, if statements
      - new, classes, imports
      - Global access (window, globalThis, etc.)
    type: string
    examples:
      - "orderValue > 50000"
      - "isHighValue"
      - "customer.segment == 'enterprise'"
      - "tri(d(1), d(2), d(4))"
      - "baseEffort * 1.5"

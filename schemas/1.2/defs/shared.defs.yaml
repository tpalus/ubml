# ============================================================================
# UBML Shared Definitions
# ============================================================================
# Contains shared types used across UBML: custom fields, annotations,
# priorities, outcomes, lifecycle events, and configuration metadata.
# ============================================================================

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://ubml.talxis.com/schemas/1.2/defs/shared.defs.yaml"
title: "UBML Shared Definitions"
description: |
  Shared definitions for UBML: custom fields, annotations, enums, and
  configuration metadata.

# ==========================================================================
# ID GENERATION CONFIGURATION
# ==========================================================================
# Central configuration for ID patterns used across UBML tooling.
# This is read by the code generator to create consistent ID utilities.
# ==========================================================================
x-ubml-id-config:
  digitLength: 5          # Zero-padded digit length (5 = 00001-99999)
  pattern: "^[A-Z]+\\d{5,}$"  # Pattern for validation
  initOffset: 1           # Starting number for 'ubml init' templates (00001)
  addOffset: 1000         # Starting number for 'ubml add' templates (01000)
  description: |
    IDs are formatted as PREFIX + zero-padded digits.
    - Init templates start at 00001 (e.g., AC00001, PR00001)
    - Add templates start at 01000 (e.g., AC0001000, PR0001000)
    - This allows ~1000 manually added items before collision

# ==========================================================================
# CATEGORY CONFIGURATION
# ==========================================================================
# Defines the display order and metadata for document/element categories.
# ==========================================================================
x-ubml-categories:
  - key: process-elements
    displayName: "Process Elements"
    order: 1
  - key: actors-resources
    displayName: "Actors & Resources"
    order: 2
  - key: information-model
    displayName: "Information Model"
    order: 3
  - key: strategy
    displayName: "Strategy"
    order: 4
  - key: analysis
    displayName: "Analysis"
    order: 5
  - key: core
    displayName: "Core Modeling"
    order: 6
  - key: advanced
    displayName: "Advanced"
    order: 7
  - key: other
    displayName: "Other"
    order: 99

$defs:

  # ==========================================================================
  # CUSTOM FIELDS
  # ==========================================================================

  CustomFields:
    description: |
      User-defined key-value pairs for extensibility.
      
      Custom fields allow adding domain-specific metadata without
      schema changes. Values can be strings, numbers, booleans,
      or arrays of strings/numbers.
      
      Examples:
        custom:
          region: "EMEA"
          priority: 1
          tags: ["urgent", "customer-facing"]
    type: object
    additionalProperties:
      oneOf:
        - type: string
        - type: number
        - type: boolean
        - type: array
          items:
            oneOf:
              - type: string
              - type: number

  # ==========================================================================
  # ANNOTATION TYPE
  # ==========================================================================

  Annotation:
    description: |
      Notes and markers attached to steps or blocks.
      
      Use annotations for:
      - note: free-form documentation or clarification
      - compliance: regulatory/compliance markers (e.g., SOX, GDPR)
      - sla: service level agreement markers
      - warning: cautions or risk indicators
      
      IMPORTANT: Milestones are NOT annotations. Use Step.kind = 'milestone'
      to create a real milestone node in the process graph. Milestones are
      significant process checkpoints that can be referenced by Phases.
      
      Examples:
        annotations:
          - type: compliance
            text: "GDPR data handling requirements"
            code: "GDPR-Art17"
          - type: sla
            text: "Must complete within 4 hours"
            code: "SLA-RESP-4H"
    type: object
    additionalProperties: false
    required: [text]
    properties:
      type:
        description: |
          Annotation type. Each type may be rendered differently in diagrams:
          - note: informational callout
          - compliance: regulatory badge with code reference
          - sla: timing/performance indicator
          - warning: alert/caution marker
        type: string
        enum: [note, compliance, sla, warning]
      text:
        description: "The annotation content displayed to users."
        type: string
      code:
        description: |
          External reference code for traceability.
          Examples: "FAST 1.1", "SOX-42", "GDPR-Art17", "SLA-RESP-4H"
        type: string

  # ==========================================================================
  # STEP LIFECYCLE EVENTS
  # ==========================================================================

  StepLifecycleEvent:
    description: |
      Events in a step's lifecycle that can trigger notifications or actions.
      
      Used by:
      - Notification.trigger: when to send alerts
      - Future: automation hooks, audit logging
      
      EVENTS:
      - onStart: step begins execution
      - onComplete: step finishes successfully
      - onError: step fails or encounters an error
      - onAssign: step is assigned to a resource
      - onReassign: step is reassigned to different resource
      - onOutcome: specific approval/decision outcome reached
      - onReviewComplete: all required reviews received
      - onDeadlineWarning: approaching deadline (requires threshold)
      - onDeadlineBreach: deadline exceeded
    type: string
    enum:
      - onStart
      - onComplete
      - onError
      - onAssign
      - onReassign
      - onOutcome
      - onReviewComplete
      - onDeadlineWarning
      - onDeadlineBreach

  # ==========================================================================
  # STANDARD APPROVAL OUTCOMES
  # ==========================================================================

  StandardOutcome:
    description: |
      Common approval/decision outcomes for consistency across processes.
      
      These are the recommended standard outcomes. Custom outcomes can
      still be defined in Approval.outcomes as strings.
      
      STANDARD OUTCOMES:
      - approved: request accepted, proceed with next steps
      - rejected: request denied, typically ends the flow or returns
      - returned: sent back for revision (not denied, needs rework)
      - deferred: decision postponed to a later time
      - escalated: decision elevated to higher authority
      - timeout: deadline breached without decision
    type: string
    enum:
      - approved
      - rejected
      - returned
      - deferred
      - escalated
      - timeout

  # ==========================================================================
  # PRIORITY LEVELS
  # ==========================================================================

  Priority:
    description: |
      Priority levels for notifications, tasks, and work items.
      
      LEVELS:
      - low: informational, can be batched or delayed
      - normal: standard handling (default)
      - high: prompt attention, visual emphasis
      - urgent: immediate action required, may trigger escalation
    type: string
    enum:
      - low
      - normal
      - high
      - urgent

  # ==========================================================================
  # COMMENT REQUIREMENT
  # ==========================================================================

  CommentRequirement:
    description: |
      When comments are required from approvers or reviewers.
      
      VALUES:
      - never: comments optional (default)
      - onNegative: required when rejecting, returning, or flagging issues
      - always: required for all responses
    type: string
    enum:
      - never
      - onNegative
      - always

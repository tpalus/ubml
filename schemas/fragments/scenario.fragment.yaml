# ============================================================================
# UBML Scenario Fragment Schema
# ============================================================================
# Defines scenarios for simulation and work mix analysis.
#
# VERSION: 1.0
# ============================================================================

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://ubml.io/schemas/1.0/fragments/scenario.fragment.yaml"
title: "UBML Scenario Fragment"
description: |
  Scenarios enable simulation and "what-if" analysis by defining:
  - Work arrivals (how work enters the process)
  - Work mix (distribution of different case types)
  - Work attributes (characteristics that affect processing)
  - Evidence data (historical observations for validation)

$defs:

  # ==========================================================================
  # WORK ATTRIBUTE
  # ==========================================================================

  WorkAttribute:
    description: |
      Characteristics of work items that affect processing.
      
      Work attributes capture variables that influence:
      - Routing decisions (which path a case takes)
      - Processing time (complexity, value thresholds)
      - Resource requirements (special skills needed)
      
      ATTRIBUTE TYPES:
      - categorical: Discrete categories (region, type, priority)
      - numeric: Continuous values (value, quantity, age)
      
      EXAMPLES:
      
      Categorical:
        region:
          type: categorical
          values:
            - name: North
              probability: 0.3
            - name: South
              probability: 0.5
            - name: West
              probability: 0.2
      
      Numeric (Normal distribution):
        orderValue:
          type: numeric
          distribution: normal
          mean: 5000
          stdDev: 1500
      
      Numeric (Fixed value):
        standardQuantity:
          type: numeric
          distribution: fixed
          value: 10
    type: object
    additionalProperties: false
    required: [type]
    properties:
      type:
        description: "Attribute type classification."
        type: string
        enum: [categorical, numeric]
      
      description:
        description: "Description of the attribute."
        type: string
      
      # Categorical type properties
      values:
        description: |
          For categorical attributes: possible values with probabilities.
          Probabilities should sum to 1.0.
        type: array
        items:
          type: object
          additionalProperties: false
          required: [name, probability]
          properties:
            name:
              type: string
            probability:
              type: number
              minimum: 0
              maximum: 1
            description:
              type: string
      
      # Numeric type properties
      distribution:
        description: |
          Distribution type for numeric attributes:
          - fixed: Single constant value
          - uniform: Uniform random between min and max
          - normal: Normal/Gaussian distribution
          - exponential: Exponential distribution
          - lognormal: Log-normal distribution
          - triangular: Triangular distribution
        type: string
        enum: [fixed, uniform, normal, exponential, lognormal, triangular]
      
      value:
        description: "For fixed distribution: the constant value."
        type: number
      
      min:
        description: "Minimum value (uniform, triangular)."
        type: number
      
      max:
        description: "Maximum value (uniform, triangular)."
        type: number
      
      mean:
        description: "Mean value (normal, lognormal)."
        type: number
      
      stdDev:
        description: "Standard deviation (normal, lognormal)."
        type: number
      
      rate:
        description: "Rate parameter (exponential)."
        type: number
      
      mode:
        description: "Mode/peak value (triangular)."
        type: number

  # ==========================================================================
  # WORK MIX ITEM
  # ==========================================================================

  WorkMixItem:
    description: |
      A category of work in the work mix distribution.
      
      Work mix defines the proportion of different case types.
      Each item represents a distinct category with its own
      characteristics and probability.
      
      Example:
        workMix:
          - name: Standard Order
            probability: 0.7
            description: "Regular orders under $10,000"
          - name: Large Order
            probability: 0.2
            description: "Orders over $10,000, require approval"
          - name: Expedited Order
            probability: 0.1
            description: "Rush orders with priority handling"
    type: object
    additionalProperties: false
    required: [name, probability]
    properties:
      name:
        description: "Name of this work category."
        type: string
      
      probability:
        description: |
          Probability/proportion of this work type.
          All work mix probabilities should sum to 1.0.
        type: number
        minimum: 0
        maximum: 1
      
      description:
        description: "Description of this work category."
        type: string
      
      attributes:
        description: |
          Attribute overrides specific to this work type.
          These override the scenario-level work attributes.
        type: object
        additionalProperties:
          $ref: "#/$defs/WorkAttribute"

  # ==========================================================================
  # ARRIVALS
  # ==========================================================================

  Arrivals:
    description: |
      Work arrival patterns for simulation.
      
      Arrivals define how work items enter the process.
      This is crucial for capacity planning and queue analysis.
      
      ARRIVAL PATTERNS:
      
      Poisson arrivals (most common for random demand):
        arrivals:
          pattern: poisson
          rate: 10
          rateUnit: per-day
      
      Scheduled arrivals (batch processing):
        arrivals:
          pattern: scheduled
          schedule: "0 9 * * MON-FRI"
          batchSize: 50
      
      Uniform arrivals (steady stream):
        arrivals:
          pattern: uniform
          rate: 5
          rateUnit: per-hour
    type: object
    additionalProperties: false
    required: [pattern]
    properties:
      pattern:
        description: |
          Arrival pattern type:
          - poisson: Random arrivals (Poisson process)
          - uniform: Even distribution over time
          - scheduled: Fixed schedule (cron-like)
          - burst: Periodic bursts of arrivals
        type: string
        enum: [poisson, uniform, scheduled, burst]
      
      rate:
        description: |
          Arrival rate (for poisson, uniform).
          Interpreted according to rateUnit.
        type: number
        minimum: 0
      
      rateUnit:
        description: "Unit for the rate value."
        type: string
        enum: [per-minute, per-hour, per-day, per-week, per-month]
      
      schedule:
        description: |
          For scheduled arrivals: cron-like schedule expression.
          
          Format: "minute hour day month weekday"
          
          Examples:
            "0 9 * * MON-FRI" - 9 AM weekdays
            "0 */2 * * *" - Every 2 hours
            "30 8 1 * *" - 8:30 AM on 1st of each month
        type: string
      
      batchSize:
        description: "Number of items per arrival event."
        type: integer
        minimum: 1
        default: 1
      
      burstSize:
        description: "For burst pattern: items per burst."
        type: integer
        minimum: 1
      
      burstInterval:
        description: "For burst pattern: time between bursts."
        $ref: "../common/defs.schema.yaml#/$defs/Duration"
      
      seasonality:
        description: |
          Seasonal adjustment factors by time period.
          Values multiply the base rate.
          
          Example (higher demand in Q4):
            seasonality:
              Q1: 0.8
              Q2: 0.9
              Q3: 1.0
              Q4: 1.3
        type: object
        additionalProperties:
          type: number
          minimum: 0

  # ==========================================================================
  # EVIDENCE
  # ==========================================================================

  Evidence:
    description: |
      Historical observation data for model validation.
      
      Evidence provides actual measurements to validate
      that the process model matches reality.
      
      EVIDENCE TYPES:
      - duration: Actual processing time observations
      - count: Volume/count measurements
      - rate: Throughput measurements
      - cost: Cost observations
      
      Example:
        evidence:
          - type: duration
            step: ST005
            metric: processingTime
            value: "4h30m"
            observedAt: "2024-01-15"
            source: "Time tracking system"
          - type: count
            metric: dailyVolume
            value: 45
            period: "2024-01"
            source: "Monthly report"
    type: object
    additionalProperties: false
    required: [type, metric, value]
    properties:
      type:
        description: "Evidence type classification."
        type: string
        enum: [duration, count, rate, cost]
      
      metric:
        description: |
          Name of the metric being measured.
          
          Examples: "processingTime", "waitTime", "dailyVolume", "throughput"
        type: string
      
      value:
        description: |
          Observed value. Can be:
          - Duration string for duration type
          - Number for count, rate, cost types
        oneOf:
          - type: string
          - type: number
      
      step:
        description: "Step this evidence relates to (if step-specific)."
        $ref: "../common/defs.schema.yaml#/$defs/StepRef"
      
      process:
        description: "Process this evidence relates to (if process-level)."
        $ref: "../common/defs.schema.yaml#/$defs/ProcessRef"
      
      observedAt:
        description: "Date/time of observation (ISO 8601)."
        type: string
        format: date-time
      
      period:
        description: |
          Time period covered by the measurement.
          
          Examples: "2024-01", "2024-Q1", "2024"
        type: string
      
      source:
        description: |
          Source of the evidence data.
          
          Examples: "Time tracking system", "ERP export", "Manual survey"
        type: string
      
      confidence:
        description: |
          Confidence level in the measurement (0-1).
          1.0 = highly reliable, 0.5 = rough estimate
        type: number
        minimum: 0
        maximum: 1
      
      notes:
        description: "Additional notes about the observation."
        type: string

  # ==========================================================================
  # SCENARIO
  # ==========================================================================

  Scenario:
    description: |
      A simulation scenario defining work characteristics and arrivals.
      
      Scenarios enable "what-if" analysis by defining:
      - How work arrives (arrivals pattern)
      - What types of work exist (work mix)
      - What attributes work items have (work attributes)
      - Historical data for validation (evidence)
      
      SCENARIO EXAMPLES:
      
      Current state baseline:
        SC001:
          name: Current State
          description: "Baseline scenario from 2023 data"
          arrivals:
            pattern: poisson
            rate: 50
            rateUnit: per-day
          workMix:
            - name: Standard
              probability: 0.8
            - name: Complex
              probability: 0.2
      
      Growth scenario:
        SC002:
          name: 2x Volume
          description: "What if volume doubles?"
          arrivals:
            pattern: poisson
            rate: 100
            rateUnit: per-day
    type: object
    additionalProperties: false
    required: [name]
    properties:
      name:
        description: "Scenario name."
        type: string
      
      description:
        description: "Detailed scenario description."
        type: string
      
      basedOn:
        description: |
          Parent scenario this inherits from.
          Used for scenario variations.
        $ref: "../common/defs.schema.yaml#/$defs/ScenarioRef"
      
      arrivals:
        description: "Work arrival patterns."
        $ref: "#/$defs/Arrivals"
      
      workMix:
        description: "Distribution of work types."
        type: array
        items:
          $ref: "#/$defs/WorkMixItem"
      
      workAttributes:
        description: |
          Work attributes that affect processing.
          Keyed by attribute name.
        type: object
        additionalProperties:
          $ref: "#/$defs/WorkAttribute"
      
      evidence:
        description: "Historical observations for validation."
        type: array
        items:
          $ref: "#/$defs/Evidence"
      
      simulationConfig:
        description: "Simulation-specific configuration."
        type: object
        additionalProperties: false
        properties:
          warmupPeriod:
            description: "Simulation warmup period to discard."
            $ref: "../common/defs.schema.yaml#/$defs/Duration"
          runLength:
            description: "Total simulation run length."
            $ref: "../common/defs.schema.yaml#/$defs/Duration"
          replications:
            description: "Number of simulation replications."
            type: integer
            minimum: 1
            default: 10
          randomSeed:
            description: "Random seed for reproducibility."
            type: integer
      
      tags:
        description: "Tags for filtering and views."
        type: array
        items:
          type: string
      
      custom:
        description: "User-defined custom fields."
        $ref: "../common/defs.schema.yaml#/$defs/CustomFields"

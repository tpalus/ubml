# ============================================================================
# UBML Entity Fragment Schema
# ============================================================================
# Defines information model entities: data entities, documents, and locations.
#
# ============================================================================

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://ubml.io/schemas/1.1/fragments/entity.fragment.yaml"
title: "UBML Entity Fragment"
description: |
  Information model entities representing the data landscape of a process.
  
  Entities fall into three categories:
  - Data Entities: Business objects that hold structured data
  - Documents: Physical or digital documents that carry information
  - Locations: Physical or logical places where work happens

$defs:

  # ==========================================================================
  # RELATIONSHIP
  # ==========================================================================

  Relationship:
    description: |
      Defines a relationship between entities in the information model.
      
      RELATIONSHIP TYPES:
      ┌────────────────┬───────────────────────────────────────────────┐
      │ Type           │ Description                                   │
      ├────────────────┼───────────────────────────────────────────────┤
      │ one-to-one     │ Each A has exactly one B                      │
      │ one-to-many    │ Each A has zero or more Bs                    │
      │ many-to-one    │ Many As belong to one B                       │
      │ many-to-many   │ Many As relate to many Bs                     │
      └────────────────┴───────────────────────────────────────────────┘
      
      Example:
        relationships:
          lines:
            target: EN00002
            type: one-to-many
            description: "Order contains multiple line items"
    type: object
    additionalProperties: false
    required: [target, type]
    properties:
      target:
        description: "Target entity ID."
        $ref: "../common/defs.schema.yaml#/$defs/EntityRef"
      
      type:
        description: "Cardinality of the relationship."
        type: string
        enum: [one-to-one, one-to-many, many-to-one, many-to-many]
        x-ubml:
          propertyNames: ["type"]
          valueMistakes:
            "1:1":
              value: "1:1"
              hint: "Use 'one-to-one' not '1:1'."
            "1:n":
              value: "1:n"
              hint: "Use 'one-to-many' not '1:n'."
            "n:1":
              value: "n:1"
              hint: "Use 'many-to-one' not 'n:1'."
            "n:m":
              value: "n:m"
              hint: "Use 'many-to-many' not 'n:m' or 'n:n'."
            hasMany:
              value: "hasMany"
              hint: "Use 'one-to-many'. Rails-style associations aren't supported."
            belongsTo:
              value: "belongsTo"
              hint: "Use 'many-to-one'. Rails-style associations aren't supported."
      
      description:
        description: "Description of the relationship semantics."
        type: string
      
      required:
        description: "Whether this relationship is required."
        type: boolean
        default: false

  # ==========================================================================
  # ATTRIBUTE
  # ==========================================================================

  Attribute:
    description: |
      A single attribute/field of an entity or document.
      
      Data types follow common industry standards:
      - string: Text values
      - number: Numeric values (integer or decimal)
      - boolean: True/false values
      - date: Date only (YYYY-MM-DD)
      - datetime: Date and time (ISO 8601)
      - duration: Time duration (e.g., "1d", "2h30m")
      - money: Currency amount with optional currency code
      - reference: Reference to another entity
      
      Example:
        attributes:
          orderValue:
            type: money
            required: true
            description: "Total value of the order"
          customerId:
            type: reference
            ref: EN003
            required: true
    type: object
    additionalProperties: false
    required: [type]
    properties:
      type:
        description: "Data type of the attribute."
        type: string
        enum: [string, number, boolean, date, datetime, duration, money, reference]
        x-ubml:
          propertyNames: ["type"]
          valueMistakes:
            int:
              value: "int"
              hint: "Use 'number' for all numeric types (integer and decimal)."
            integer:
              value: "integer"
              hint: "Use 'number' for all numeric types."
            float:
              value: "float"
              hint: "Use 'number' for all numeric types."
            decimal:
              value: "decimal"
              hint: "Use 'number' for all numeric types."
            text:
              value: "text"
              hint: "Use 'string' for text values."
            varchar:
              value: "varchar"
              hint: "Use 'string' for text values."
            bool:
              value: "bool"
              hint: "Use 'boolean' not 'bool'."
            timestamp:
              value: "timestamp"
              hint: "Use 'datetime' for date and time values."
            currency:
              value: "currency"
              hint: "Use 'money' for currency/monetary amounts."
            ref:
              value: "ref"
              hint: "Use 'reference' for entity references."
      
      description:
        description: "Description of the attribute."
        type: string
      
      required:
        description: "Whether this attribute is required."
        type: boolean
        default: false
      
      ref:
        description: |
          For type=reference, the target entity ID.
        $ref: "../common/defs.schema.yaml#/$defs/EntityRef"
      
      default:
        description: "Default value for the attribute."
        oneOf:
          - type: string
          - type: number
          - type: boolean
      
      enum:
        description: "Allowed values for this attribute."
        type: array
        items:
          oneOf:
            - type: string
            - type: number

  # ==========================================================================
  # ENTITY
  # ==========================================================================

  Entity:
    description: |
      A data entity in the information model.
      
      Entities represent business objects that:
      - Are created, read, updated, or deleted by process steps
      - Have structured attributes with defined types
      - Have relationships to other entities
      
      ENTITY EXAMPLES:
      - Order, Customer, Product, Invoice
      - Contract, Case, Request, Incident
      - Employee, Department, Project, Task
      
      ENTITY vs DOCUMENT:
      Entities are structured data objects in systems.
      Documents are physical or digital files with content.
      
      Example:
        EN00001:
          name: Sales Order
          description: "Customer order with line items"
          attributes:
            orderId:
              type: string
              required: true
            orderDate:
              type: date
              required: true
            totalValue:
              type: money
          relationships:
            customer:
              target: EN00002
              type: many-to-one
    type: object
    additionalProperties: false
    required: [name]
    properties:
      name:
        description: "Human-readable entity name."
        type: string
      
      description:
        description: "Detailed description of the entity."
        type: string
      
      attributes:
        description: |
          Entity attributes, keyed by attribute name.
        type: object
        additionalProperties:
          $ref: "#/$defs/Attribute"
      
      relationships:
        description: |
          Relationships to other entities, keyed by relationship name.
        type: object
        additionalProperties:
          $ref: "#/$defs/Relationship"
      
      system:
        description: |
          System or application where this entity is mastered.
          Used for data lineage and integration planning.
          
          Example: "SAP ERP", "Salesforce CRM"
        type: string
      
      lifecycle:
        description: |
          Entity lifecycle states, if applicable.
          
          Example: ["Draft", "Submitted", "Approved", "Closed"]
        type: array
        items:
          type: string
      
      tags:
        description: "Tags for filtering and views."
        type: array
        items:
          type: string
      
      custom:
        description: "User-defined custom fields."
        $ref: "../common/defs.schema.yaml#/$defs/CustomFields"

  # ==========================================================================
  # DOCUMENT
  # ==========================================================================

  Document:
    description: |
      A document in the information model.
      
      Documents represent physical or digital files that:
      - Are inputs to or outputs from process steps
      - Have a format (PDF, Word, Excel, etc.)
      - May require signatures or approvals
      - May be templates or generated documents
      
      DOCUMENT EXAMPLES:
      - Contract, Invoice, Purchase Order, Report
      - Application Form, Approval Form, Checklist
      - Technical Drawing, Specification, Manual
      
      DOCUMENT vs ENTITY:
      Documents have file content and format.
      Entities are structured data in systems.
      
      Example:
        DC001:
          name: Contract Agreement
          format: pdf
          description: "Signed contract between parties"
          isTemplate: false
          requiresSignature: true
    type: object
    additionalProperties: false
    required: [name]
    properties:
      name:
        description: "Human-readable document name."
        type: string
      
      description:
        description: "Detailed description of the document."
        type: string
      
      format:
        description: |
          Document format or file type.
          
          Examples: "pdf", "docx", "xlsx", "jpg", "dwg"
        type: string
      
      isTemplate:
        description: |
          Whether this is a template document.
          Templates are used to generate actual documents.
        type: boolean
        default: false
      
      templateSource:
        description: |
          For generated documents, the template document ID.
        $ref: "../common/defs.schema.yaml#/$defs/DocumentRef"
      
      requiresSignature:
        description: "Whether the document requires signature(s)."
        type: boolean
        default: false
      
      signatureCount:
        description: "Number of signatures required."
        type: integer
        minimum: 0
      
      retentionPeriod:
        description: |
          How long the document must be retained.
          
          Example: "7y" (7 years)
        $ref: "../common/defs.schema.yaml#/$defs/Duration"
      
      confidentiality:
        description: |
          Confidentiality classification.
          
          Common values:
          - public: No restrictions
          - internal: Internal use only
          - confidential: Restricted access
          - secret: Highly restricted
        type: string
        enum: [public, internal, confidential, secret]
      
      system:
        description: |
          System or repository where this document is stored.
          
          Example: "SharePoint", "DMS", "Archive System"
        type: string
      
      relatedEntity:
        description: |
          Entity this document relates to or is attached to.
          
          Example: A contract document relates to a Contract entity.
        $ref: "../common/defs.schema.yaml#/$defs/EntityRef"
      
      tags:
        description: "Tags for filtering and views."
        type: array
        items:
          type: string
      
      custom:
        description: "User-defined custom fields."
        $ref: "../common/defs.schema.yaml#/$defs/CustomFields"

  # ==========================================================================
  # LOCATION
  # ==========================================================================

  Location:
    description: |
      A physical or logical location where work happens.
      
      Locations are important for:
      - Understanding where work is performed
      - Modeling travel time between locations
      - Capacity planning for physical spaces
      - Compliance with location-specific regulations
      
      LOCATION EXAMPLES:
      - Office, Warehouse, Factory, Store
      - Field Site, Customer Premises
      - Data Center, Cloud Region
      
      Example:
        LO001:
          name: Main Warehouse
          type: warehouse
          address: "123 Industrial Blvd, City"
          capacity: 1000
          capacityUnit: "pallets"
    type: object
    additionalProperties: false
    required: [name]
    properties:
      name:
        description: "Human-readable location name."
        type: string
      
      description:
        description: "Detailed description of the location."
        type: string
      
      type:
        description: |
          Location type classification.
        type: string
        examples:
          - office
          - warehouse
          - factory
          - store
          - field
          - customer-site
          - data-center
          - remote
      
      address:
        description: "Physical address, if applicable."
        type: string
      
      coordinates:
        description: |
          Geographic coordinates (latitude, longitude).
          Used for travel time calculations and mapping.
        type: object
        additionalProperties: false
        properties:
          latitude:
            type: number
            minimum: -90
            maximum: 90
          longitude:
            type: number
            minimum: -180
            maximum: 180
      
      timezone:
        description: |
          Timezone for the location (IANA timezone name).
          
          Example: "Europe/Prague", "America/New_York"
        type: string
      
      capacity:
        description: "Location capacity (numeric value)."
        type: number
        minimum: 0
      
      capacityUnit:
        description: |
          Unit of capacity measurement.
          
          Examples: "people", "pallets", "vehicles", "desks"
        type: string
      
      workingHours:
        description: |
          Working hours for this location.
          
          Example: "Mon-Fri 08:00-17:00"
        type: string
      
      parent:
        description: |
          Parent location for hierarchical structure.
          
          Example: A warehouse inside a larger logistics hub.
        $ref: "../common/defs.schema.yaml#/$defs/LocationRef"
      
      tags:
        description: "Tags for filtering and views."
        type: array
        items:
          type: string
      
      custom:
        description: "User-defined custom fields."
        $ref: "../common/defs.schema.yaml#/$defs/CustomFields"
